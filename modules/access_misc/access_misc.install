<?php

/**
 * @file
 */

use Drupal\node\Entity\Node;
use Drupal\webform\Entity\Webform;
use Drupal\webform\Entity\WebformSubmission;
use Drupal\redirect\Entity\Redirect;

/**
 * Update Resource webform submissions.
 */
function access_misc_update_9001() {
  $webform = Webform::load('resource');
  if ($webform->hasSubmissions()) {
    $query = \Drupal::entityQuery('webform_submission')
      ->condition('webform_id', 'resource')
      ->accessCheck(FALSE);
    $result = $query->execute();
    $submission_data = [];
    foreach ($result as $item) {
      // debug($item);
      $submission = WebformSubmission::load($item);
      $submission->save();
    }
  }
}

/**
 * Set config access_misc.settings misc_var= and
 * access_id_var=customfield_10103.
 */
function access_misc_update_9003() {
  $config = \Drupal::configFactory()->getEditable('access_misc.settings');
  $config->set('access_id_var', 'customfield_10103');
  $config->set('misc_var', 'customfield_10108=[user:display-name]');
  $config->save();
}

/**
 * Change field length of node__field_access_org_name and
 * node_revision__field_access_org_name.
 */
function access_misc_update_9004() {
  // Truncate tables.
  $connection = \Drupal::database();
  $connection->truncate('node__field_access_org_name')->execute();
  $connection->truncate('node_revision__field_access_org_name')->execute();

  // Update the field length in the field config.
  $config = \Drupal::config('field.storage.node.field_access_org_name');
  $settings = $config->get('settings');
  $settings['max_length'] = 300;
  \Drupal::configFactory()->getEditable('field.storage.node.field_access_org_name')->set('settings', $settings)->save();

  // Update the field length in the database.
  $field_spec = [
    'type' => 'varchar',
    'length' => '300',
    'not null' => TRUE,
  ];
  \Drupal::database()->schema()->changeField('node__field_access_org_name', 'field_access_org_name_value', 'field_access_org_name_value', $field_spec);
  \Drupal::database()->schema()->changeField('node_revision__field_access_org_name', 'field_access_org_name_value', 'field_access_org_name_value', $field_spec);

  drupal_flush_all_caches();

  // Re-insert the field data.
  $nodes = [
    '366' => 'University of Delaware',
    '367' => 'Indiana University',
    '368' => 'Johns Hopkins University MARCC',
    '369' => 'Purdue University',
    '370' => 'Indiana University',
    '371' => 'Purdue University',
    '372' => 'University of Delaware',
    '373' => 'San Diego Supercomputer Center',
    '374' => 'University of Delaware',
    '375' => 'Open Science Grid',
    '376' => 'University of Kentucky',
    '377' => 'San Diego Supercomputer Center',
    '378' => 'Indiana University',
    '379' => 'Johns Hopkins University MARCC',
    '380' => 'San Diego Supercomputer Center',
    '381' => 'National Institute for Computational Sciences',
    '382' => 'Pittsburgh Supercomputing Center',
    '383' => 'Texas Advanced Computing Center',
    '384' => 'Texas A&M University',
    '385' => 'Open Storage Network',
    '386' => 'Purdue University',
    '387' => 'National Center for Atmospheric Research',
    '388' => 'National Center for Supercomputing Applications',
    '389' => 'National Institute for Computational Sciences',
    '390' => 'Pittsburgh Supercomputing Center',
    '391' => 'Texas Advanced Computing Center',
    '392' => 'Pittsburgh Supercomputing Center',
    '393' => 'National Center for Supercomputing Applications',
    '394' => 'Pittsburgh Supercomputing Center',
    '395' => 'Johns Hopkins University MARCC',
    '396' => 'Science Gateways Community Institute',
    '397' => 'XSEDE',
    '398' => 'Pittsburgh Supercomputing Center',
    '400' => 'National Center for Supercomputing Applications',
    '401' => 'Texas Advanced Computing Center',
    '407' => 'Indiana University',
  ];
  foreach ($nodes as $nid => $node) {
    $node_update = \Drupal::entityTypeManager()->getStorage('node')->load($nid);
    $node_update->set('field_access_org_name', $node);
    $node_update->save();
  }
}

/**
 * Update private directory to point to resumes.
 */
function access_misc_update_9005() {
  $years = [
    '2020',
    '2021',
    '2022',
    '2023',
  ];
  foreach ($years as $year) {
    $query = \Drupal::database()->select('file_managed', 'f');
    $query->condition('f.uri', "private://$year%", 'LIKE');
    $query->fields('f', ['fid', 'uri']);
    $uri = $query->execute()->fetchAll();
    foreach ($uri as $uri_value) {
      $uri_short = str_replace('private://', '', $uri_value->uri);
      $updated_uri = 'private://resume/' . $uri_short;
      $query = \Drupal::database()->update('file_managed')
        ->fields([
          'uri' => $updated_uri,
        ])
        ->condition('fid', $uri_value->fid)
        ->execute();
    }
  }
}

/**
 * Delete entity.definitions.bundle_field_map from key_value.
 */
function access_misc_update_9007() {
  $query = \Drupal::database()->delete('key_value');
  $query->condition('collection', 'entity.definitions.bundle_field_map', '=');
  $query->condition('name', 'menu_link_content', '=');
  $result = $query->execute();

}

/**
 * Update node/434 body text format.
 */
function access_misc_update_9008() {
  $node = \Drupal::entityTypeManager()->getStorage('node')->load(434);
  $node->body->format = 'full_no_editor';
  $node->save();
}

/**
 * Set resource flag state.
 */
function access_misc_update_9010() {
  $flag = [];
  \Drupal::state()->set('resource_flags', $flag);
}

/**
 * Helper function to update node body text.
 */
function update_node_body($nid, $body, $format) {
  $query = \Drupal::entityQuery('node')
    ->condition('nid', $nid)
    ->accessCheck(FALSE);

  $nids = $query->execute();
  foreach ($nids as $nid) {
    $node = Node::load($nid);
    $node->set('body', [
      'format' => $format,
      'value' => $body,
    ]);
    $node->save();
  }
}

/**
 * Helper function to update block body text.
 */
function update_block_body($bid, $body, $format) {
    $block = \Drupal\block_content\Entity\BlockContent::load($bid);
    $block->set('body', [
      'format' => $format,
      'value' => $body,
    ]);
    $block->save();
}

/**
 * Helper function to Remove a node and replace it with another node.
 */
function node_replace($old_node, $new_node) {
  $prev_node = \Drupal::entityTypeManager()->getStorage('node')->load($old_node);
  $url_alias = \Drupal::service('path_alias.manager')->getAliasByPath('/node/' . $old_node);
  $prev_node->delete();

  $next_node = \Drupal::entityTypeManager()->getStorage('node')->load($new_node);
  $path_alias = \Drupal\path_alias\Entity\PathAlias::create([
    'path' => "/node/$new_node",
    'alias' => $url_alias,
  ]);
  $path_alias->save();
  $next_node->save();
  // Create redirect from old node to new node.
  // Redirect::create([
  //   'redirect_source' => "node/$old_node",
  //   'redirect_redirect' => $url_alias,
  //   'language' => 'und',
  //   'status_code' => '301',
  // ])->save();
}

/**
 * Update XDMoD page content.
 */
function access_misc_update_10000(&$sandbox) {
  // XDMoD page.
  $nid = 269;
  $format = 'full_no_editor';
  $body = <<<EOT
<div class="grid grid-cols-1 md--grid-cols-4 gap-5">
  <div class="col-1 col-span-3 row-span-2">
    <section class="mb-10" id="about">
      <p class="prose text-dark-teal text-2xl leading-9 mb-10">View information about allocations, usage data and usage efficiency as well as specific information about your usage and general historic usage of the ACCESS allocated resources.</p>
      <div class="grid grid--cols-1 md--grid-cols-3">
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold">Optimize Job Efficiency</p><p>View information about active and expired allocations.</p>
          </div>
        </div>
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold">Monitor allocation usage</p>
            <p>View information about active and expired allocations.</p>
          </div>
      </div>
      <div class="flex">
        <div class="not-prose shrink-0 me-3">
          <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
        </div>
        <div>
          <p class="font-extrabold">View historical usage</p>
          <p>View both personal usage and that of aggregated users. View information about active and expired allocations.</p>
        </div>
      </div>
    </div>
  </section>
  <section class="mb-10" id="using-xdmod">
    <h2>Using XDMoD</h2>
    <p>
      [accordion summary="What do I need to do to start using XDMoD?" text="Anyone with an ACCESS Identity can login to XDMoD. Information about your ACCESS allocations and historical usage of ACCESS resources is automatically populated."][/accordion]
      [accordion summary="How can I find information about my ACCESS allocation usage?" text="Just log on to XDMoD and click on the “Allocations” tab. It will display information about your allocations."][/accordion]
      [accordion summary="How can I use XDMoD to improve my job efficiency and allocation usage efficiency?" text="Many jobs do not use all of the resources asked for so they effectively use the allocation inefficiently. Your recent jobs show in the “ Jobs” window on the DashBoard tab that is displayed when you login to XDMoD. Click on a job to view detailed information. For older jobs, you can use the “Search” button in the Job Viewer tab. If you know the Job Identifier and the compute resource then you can use the Quick Job Lookup. Alternatively, you can search for your jobs by entering “User” in the filter of the Advanced Search, finding your user name in the Select a Value box, then selecting the job you want to view in the viewer from the list of jobs displayed. Use the output of the Job Viewer to check for how many cores and nodes are actually used as opposed to how many you may have requested."][/accordion]
      [accordion summary="How can I view historical usage in XDMoD?" text="You can view your own historical usage or the historical aggregated usage by logging in to XDMoD and using the Usage tab to make simple plots of data or the Metric Explorer tab to make more complex plots. A great variety of information is available from XDMoD. "][/accordion]
    </p>
  </section>
</div>
<div class="col-2 sticky top-0">
  <nav class="bg-md-teal mb-10 p-5">
    <a class="font-extrabold text-white no-underline hover--underline hover--text-light-teal block" href="#">ACCESS XDMoD </a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#about">About</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#using-xdmod">Using XDMoD</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#">XDMoD Support</a>
  </nav>
</div>
</div>
<section class="bg-light-teal -mx-50% px-50% py-10" id="xdmod-support">
  <div class="container">
    <h2>XDMoD Support</h2>
    <div class="grid grid-cols-1 sm--grid-cols-2 md--grid-cols-3 gap-5">
      [square icon="/themes/contrib/asp-theme/images/icons/ico-launch.svg" title="LAUNCH XDMoD" link="https://xdmod.access-cs.org"][/square]
      [square icon="/themes/contrib/asp-theme/images/icons/ico-documentation.svg" title="DOCUMENTATION" link="https://metrics.access-cs.org"][/square]
      [square icon="/themes/contrib/asp-theme/images/icons/ico-contactus.svg" title="CONTACT US" link="https://support.access-ci.org/open-a-ticket"][/square]
    </div>
  </div>
</section>
EOT;
  update_node_body($nid, $body, $format);
}

/**
 * Update CCEP page content.
 */
function access_misc_update_10001(&$sandbox) {
  // CCEP page.
  $nid = 365;
  $format = 'full_no_editor';
  $body = <<<EOT
<div class="grid grid-cols-1 md--grid-cols-4 md--grid-cols-2 gap-5">
  <div class="col-1 col-span-3 row-span-2">
    <section class="mb-10" id="about">
       <p class="prose text-dark-teal text-2xl leading-9 mb-10">CCEP (CSSN Community Engagement Program) gives travel rewards to ANYONE for community engagement, feedback forums, documentation and much more!</p>
        <p>Submissions are reviewed once a month. Please submit by October 1 for SC23 or two months prior to the conference that you desire to attend.</p>
    </section>
    <section class="mb-10" id="tier1">
      <h2>Tier 1: $1,000</h2>
      [accordion summary="Intro to ACCESS lecture" text="Prepare an Intro to ACCESS lecture, tutorial, or slide deck for Basic, Intermediate, or Advanced User. This ideally should be a review of multiple ACCESS resources (e.g. how to get an allocation, how to get started, tips and tricks, software and hardware overview) or a general review of offerings that Support/Allocations provides to the community."][/accordion]
      [accordion summary="Intro to ACCESS lecture for domain specific conference" text="Prepare an Intro to ACCESS lecture, tutorial, or slide deck for a domain specific conference (e.g. AGU, ODSC, IPSA, etc) or community (biology department, chemistry honor society, political science affinity group, media studies lecture series, etc.)"][/accordion]
      [accordion summary="Documentation OR tutorial/lecture on requested topic" text="Expand the knowledge base by contributing in one of these areas of expertise.<ul><li>LLM</li><li>Intro to Linux</li><li>Python</li><li>Job Scheduling</li><li>Data Transfer, Software Installations</li><li>Parallel Programming</li><li>GPU Acceleration</li><li>Rust</li></ul>"][/accordion]
      [accordion summary="Expand the community knowledge base by adding CI Links" text='Share your expertise by contributing 10 of your &ldquo;go-to&rdquo; research computing-related websites, training modules, tutorials and/or documentation pages to the <a href="/ci-links">CI Links</a> page. Please contribute first, then apply for your reward. Submissions will be reviewed once a month by the CCEP committee.'][/accordion]
      [accordion summary="ACCESS Support User Stories*" text="<em>* Currently unavailable.</em> Provide detailed information about your experience with ACCESS— the resources and software you used, and how it affected your research. Your feedback could be used to improve ACCESS Support services and/or featured as a case study on the website."][/accordion]
    </section>
    <section class="mb-10" id="tier2">
      <h2>Tier 2: $2,500</h2>
      [accordion summary="Intro to ACCESS lecture AND event" text="Prepare an Intro to ACCESS lecture, tutorial, or slide deck for Basic, Intermediate, or Advanced User. This ideally should be a review of multiple ACCESS resources (e.g. how to get an allocation, how to get started, tips and tricks, software and hardware overview) or a general review of offerings that Support/Allocations provides to the community AND host a live community event such as a workshop or tutorial, a DEI meeting, or a gathering of students/faculty/staff to promote awareness and use of ACCESS resources."][/accordion]
      [accordion summary="Intro to ACCESS lecture for domain specific conference AND a written document" text="Prepare an Intro to ACCESS lecture, tutorial, or slide deck for a domain specific conference (e.g. AGU, ODSC, IPSA, etc) or community (biology department, chemistry honor society, political science affinity group, media studies lecture series, etc.) AND a written document that can be shared and reused for training in the future."][/accordion]
      [accordion summary="Documentation AND tutorial/lecture/event on requested topic" text="Expand the knowledge base by contributing in one of these areas of expertise.<ul><li>LLM</li><li>Intro to Linux</li><li>Python</li><li>Job Scheduling</li><li>Data Transfer, Software Installations</li><li>Parallel Programming</li><li>GPU Acceleration</li><li>Rust</li></ul>"][/accordion]
      [accordion summary="Share your expertise on ask.CI, the Q&A platform for the research computing community" text='Expand the community knowledge base by contributing 10 posts (new topics or answers to existing topics, with a maximum of 5 new topics) on ask.CI. Submissions will be reviewed once a month by the CCEP committee. Please post first, then apply for your reward.'][/accordion]
      [accordion summary="Tag Taxonomy Curation*" text="<em>* Currently unavailable.</em> Assess current tag taxonomy structure and suggest modifications to better serve the ACCESS computer researcher ecosystem."][/accordion]
      [accordion summary="Serve as a MATCH Plus Mentor*" text="<em>* This opportunity will reopen Spring 2024</em>"][/accordion]
      [accordion summary="Serve on the CCEP Review Committee*" text="<em>* This opportunity will reopen Spring 2024</em>"][/accordion]
    </section>
    <section class="mb-10">
      <a class="btn btn-primary" href="https://forms.gle/u4d4kCtsYNQgzxjq5">Apply to CCEP</a>
    </section>
  </div>
  <div class="col-2 sticky top-0">
      <nav class="bg-md-teal mb-10 p-5">
        <a class="font-extrabold text-white no-underline hover--underline hover--text-light-teal block" href="#">CCEP</a>
        <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#tier1">Tier 1</a>
        <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#tier2">Tier 2</a>
        <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#fine-print">Fine Print</a>
      </nav>
    </div>
  </div>
</div>
<div id="fine-print" class="py-10 bg-light-teal -mx-50% px-50%">
  <div class="container">
    <h2>Important Fine Print</h2>
    <p>CCEP (CSSN Community Engagement Program) gives travel rewards to ANYONE for community engagement, feedback forums, documentation and much more! Submissions are reviewed once a month. Please submit by October 1 for SC23 or two months prior to the conference that you desire to attend.</p>
    <p><a href="/ccep-pilot-details">See all the details</a></p>
  </div>
</div>
EOT;
  update_node_body($nid, $body, $format);
}

/**
 * Update Science Gateways page content.
 */
function access_misc_update_10002(&$sandbox) {
  // Science Gateways page.
  $nid = 278;
  $format = 'full_no_editor';
  $body = <<<EOT
  <div class="grid grid-cols-1 md--grid-cols-4  gap-5">
  <div class="col-1 col-span-3 row-span-2">

	<section class="mb-10" id="about">
      	<p class="prose text-dark-teal text-2xl leading-9 mb-10">A science portal or science gateway is a community-developed set of tools, applications, and data integrated through a web-based portal or a suite of applications. They provide access to tools used in cutting-edge research – telescopes, seismic shake tables, supercomputers, sky surveys, undersea sensors, and more. These gateways often connect diverse resources and make them easily accessible, lowering the barriers traditionally required to access these resources.
       </p>

	<div class="grid grid-cols-1 md--grid-cols-3">
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold">Advance access to resources</p>
           <p>By connecting science gateways to cutting-edge ACCESS resources and software, training and research workflows are streamlined through one interface.</p>
          </div>
        </div>
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold">Collaborative space</p>
           <p>Gateways provide an interactive community space for sharing knowledge of methods, code, data, results, and training materials.</p>
          </div>
      </div>
      <div class="flex">
        <div class="not-prose shrink-0 me-3">
          <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
        </div>
        <div>
          <p class="font-extrabold">Enhanced research products</p><p>Gateways provide a space to share research outcomes and supplementary products. They enable collaborators, peers, and future researchers to discover and learn.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="mb-10" id="using-science-gateways">
 	<h2>Using Science Gateways</h2>
	<p>	Through user-friendly online interfaces, Science Gateways combine cyberinfrastructure components and support a community-specific set of tools, applications, and data collections.
	</p>
	<p> Search existing science gateways in our <a href=https://catalog.sciencegateways.org/#/home>gateways catalog</a> or talk to <a href=https://sciencegateways.org/work-with-us>SGX3 for support</a>  in choosing a science gateway. You can join an existing science gateway by creating an account or communicating to the team hosting the science gateway with an inquiry to join. Many science gateway teams hope you will join them and look to grow their communities.
	</p>
<p>
    	[accordion summary="How do I use a Gateway?" text="You can use most science gateways like a typical website. Many science gateways provide open access to research products which you can find from the home page of the science gateway or search engines on the science gateway. To access HPC resources, run software, or add your own research products, most science gateways will ask that you authenticate. Depending on the science gateway, you may either create a local account on gateway or authenticate through another known entity like your university's login portal, Google, or other service."][/accordion]

[accordion summary="What are some examples of Science Gateways?" text="There are over 630 science gateways and related software in our <a href=https://catalog.sciencegateways.org/#/home>gateways catalog</a>. Some of the most popular science gateways include: <ul><li><a href=https://www.phylo.org/>CIPRES</a> - a public resource for phylogenetics and population biology.</li><li><a href=https://nanohub.org/>nanoHUB</a> - a diverse community of nanotechnology researchers and educators.</li><li><a href=https://genapp.rocks/>GenApp</a> - a framework for rapidly building and deploying graphical front ends for command line applications to an extensible variety of targets.</li><li><a href=https://opentopography.org/>OpenTopography</a> - a science gateway that facilitates community access to high-resolution, Earth science-oriented, topography data, and related tools and resources.</li><li><a href=https://nemar.org/>NEMAR</a> - an open access data, tools, and compute resource for finding, assessing and processing human NeuroElectroMagnetic data (EEG, MEG, iEEG) shared by its authors through OpenNeuro.org.</li><li><a href=https://www.designsafe-ci.org/>DesignSafe</a> - a natural hazards research science gateway where researchers store, analyze, curate, publish, and discover data within their community.</li><li><a href=https://ebird.org/home>eBird</a> - a science gateway where birdwatching data is collected and shared to power new data-driven approaches to science, conservation and education.</li><li><a href=https://gateway.delta.ncsa.illinois.edu/>Delta Science Gateway</a> - a gateway for researchers who want to enable others in the community to use their applications and run them on the GPU-centric NCSA Delta computational resource.</li></ul>"][/accordion]

[accordion summary="What's involved with adapting a Science Gateway?" text="<p>You can join an existing science gateway by creating an account or communicating to the team hosting the science gateway with an inquiry to join. Many science gateway teams hope you will join them and look to grow their communities.</p><p>If you would like to establish your own science gateway, you can work with these science gateway providers to request a new science gateway for your project. When you do create your own science gateway, you have the opportunity to design it to fit your project’s needs. Some of the below projects are open source and some offer full support in managing and hosting your science gateway. The benefit of working with a fully hosted team is you can outsource the management, development, and security to these experienced and fully staffed teams.</p><ul><li><a href=https://hubzero.org/>Hubzero®</a> - a software platform for building powerful websites that host analytical tools, publish data, share resources, collaborate and build communities in a single web-based ecosystem.</li><li><a href=https://tacc-cloud.readthedocs.io/en/latest/>Tapis</a> - an open source, science-as-a-service API platform for powering your digital lab.</li><li><a href=https://openondemand.org/>Open OnDemand </a> - a platform that empowers students, researchers, and industry professionals with remote web access to supercomputers.</li><li><a href=https://airavata.apache.org/>Apache Airavata</a> - a software framework that enables you to compose, manage, execute, and monitor large scale applications and workflows.</li><li><a href=https://usegalaxy.org/ >Galaxy</a> -  is an open source, web-based platform for data intensive biomedical research.</li><li><a href=https://www.globus.org/>Globus</a> - a secure, reliable research data management service.</li><li><a href=https://pegasus.isi.edu/>Pegasus</a> - a project that encompasses a set of technologies that help workflow-based applications execute in a number of different environments including desktops, campus clusters, grids, and clouds.</li></ul>"][/accordion]

      	[accordion summary="Why should I use a Gateway?" text="Science gateways elevate your research. They provide an actively supported space to streamline all your research workflow processes in one interface. They also break down barriers to research outcomes and educational training."][/accordion]

    </p>
  </section>
</div>
<div class="col-2 sticky top-0">
  <nav class="bg-md-teal mb-10 p-5">
    <a class="font-extrabold text-white no-underline hover--underline hover--text-light-teal block" href="#">Science Gateways</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#about">About</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#using-science-gateways">Using Science Gateways</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#science-gateways-support">Science Gateways Support</a>
  </nav>
</div>
</div>

<section class="bg-light-teal -mx-50% px-50% py-10" id="science-gateways-support">
<container>
<h2>Science Gateways Support</h2>
    <div class="grid grid-cols-1 sm--grid-cols-2 md--grid-cols-3 gap-5">

      [square icon="/themes/contrib/asp-theme/images/icons/ico-consult.svg" title="Technical Consultancy" link="https://sciencegateways.org/work-with-us" text="Advice on the best platform for your project or on integrating HPC resources into your science gateway pipeline."][/square]

 [square icon="/themes/contrib/asp-theme/images/icons/ico-training.svg" title="Workforce Development" link="https://sciencegateways.org/education-training" text="Mentoring, career development, internships, workshops & hackathons." ][/square]

      [square icon="/themes/contrib/asp-theme/images/icons/ico-workforce.svg" title="Sustainability Training" link="https://sciencegateways.org/education-training/sustainability-training" text="Learn to articulate your project’s value, define stakeholder interactions, and explore funding models." ][/square]

      [square icon="/themes/contrib/asp-theme/images/icons/ico-ui.svg" title="Usability Consultancy" link="https://sciencegateways.org/work-with-us" text="The SGX3 Usability Team can help create a new user interface or improve an existing design."][/square]

      [square icon="/themes/contrib/asp-theme/images/icons/ico-blueprint.svg" title="Blueprint Factory" link="https://sciencegateways.org/our-services/blueprint-factories" text="CIPs, scientists, and resource operators explore future domain needs and create plans for the next generation of science gateways." ][/square]

      [square icon="/themes/contrib/asp-theme/images/icons/ico-contactus.svg" title="Contact Us" link="https://sciencegateways.org/work-with-us" text="Want to work with us? Request a consult, share a letter of collaboration, or ask a question." ][/square]
    </div>
</container>
  </section>
EOT;
  update_node_body($nid, $body, $format);
}

/**
 * Update Match Engagement Guide page content.
 */
function access_misc_update_10003(&$sandbox) {
  // Match Engagement Guide page id.
  $nid = 6108;
  $format = 'full_no_editor';
  $body = <<<EOT
<div class="grid grid-cols-1 md--grid-cols-4 gap-5">
  <div class="col-1 col-span-3 ">
    <section class="mb-5" id="about">
      <p class="text-dark-teal text-2xl prose leading-9 mb-2">
        Steering Committee members review engagement request and decide whether it should be a MATCH Plus or MATCH Premier Engagement. Committee members then match CSSN members to the researcher needs and help the project move along to completion. 
      </p>
    </section>
    <img class="block w-40 not-prose ms-auto mb-2" src="/themes/contrib/asp-theme/images/logos/match.svg" alt="match team" >
    <section class="bg-light-teal  px-5 py-10 mb-5" >
      <h2 class="colored-square colored-square-orange">MATCH Plus Guide</h2>
      <p>MATCH Plus supports researchers through short-term engagements that pair a student with an experienced mentor to address an immediate research need. Mentors are ACCESS Computational Science and Support Network (CSSN) members with subject matter expertise and professional facilitation skills relevant to the engagement.</p>
      <p class="text-dark-teal font-extrabold mb-4">Researchers work with a Steering Committee member:</p>
      [accordion summary="Request an engagement" color="white"  text="Researcher submits an engagement request. SC member helps craft a viable submission to bring to committee for approval.<ol><li>Researcher logs in with an ACCESS Support Portal account.</li><li>Researcher fills in a request <a href=/node/add/match_engagement?type=plus>form</a>, that is emailed on submission to everyone with the MATCH PM role. (In the pilot MATCH SC members have the MATCH PM role.)</li><li>Any SC member reviews submission, and changes status to “Received” if it seems viable. This will send an email to the researcher informing them that their request is being considered, and telling them that additional fields are now shown on the submission form.</li><li>Received engagements are shared at the next SC meeting and each is assigned an SC member as point of contact/concierge.</li><h4>Publishing an engagement</h4><ol><li>When engagements are  Received, additional engagement information fields are revealed.</li><li>POC/Concierge works with researcher to identify:  <ul><li>Engagement image</li><li>Appropriate tags</li><li>2 or more engagement milestones</li><li>“Student profile” for student recruitment</li></ul></li><li>Check for completion:<ul><li>Are necessary fields filled in?</li><li>Is the engagement well conceived and described?</li><li>Are the milestones SMART (Specific, Measurable, Achievable, Relevant and Timed) and does the overall timeline look reasonable?</li><li>Evaluate whether the engagement is MATCH Plus or MATCH Premier.</li></ul></li><li>After the fields are filled in, the author changes the status to “In Review” and the engagement link is sent to the SC for review with a week deadline for comments.</li><li>After one week, if there are no comments, the engagement is moved into the “Recruiting” state by a MATCH PM. This makes the summary tile for the engagement visible on the MATCH Engagement Page, with a visible recruiting flag, and an “I’m interested” button shows up on the detail page for the engagement.</li></ol>"][/accordion]
      [accordion summary="Recruit team members" color="white" text="<p>SC member matches a mentor and student to an accepted engagement.</p><h4>Recruiting students</h4><p>Approved engagements need student-facilitators paired with mentors. If the researcher has chosen a student, the process can move to step 5 below.</p><ol><li>Student express interest by using “I'm interested”  button. POC/Conceirge receives daily summary of interest. POC/Concierge contacts individuals that express interest.</li><li>Potential students are interviewed.</li><li>Suitable candidates are connected to researchers for approval. Student-facilitators report on their visa status (such as F-1) to leave time for relevant hurdles.</li><li>Researchers are informed of selected students.</li><li>Compensation terms are confirmed with the student.</li><li>After confirmation, the engagement letter is sent to the student.</li><li>Once the signed engagement letter is received, the payment process can proceed.</li></ol><h4>Recruiting mentors</h4><ol><li>Mentors express interest by clicking “I'm interested”  button. POC/Concierge receives daily summary of interest and contacts mentors that express interest.</li><li>Potential mentors are interviewed.</li><li>Suitable candidates are connected to researchers for approval.</li></ol>"][/accordion]
      [accordion summary="Implement an engagement" color="white" text="<p>The student carries out the engagement with the team and participates in regular meetings.</p><h4>Launch Presentation</h4><p>The student prepares and presents a launch presentation The first payment is typically tied to this presentation.</p><ol><li>The student uses this <a href=#>template</a> provided as a guide for the Launch Presentation.</li><li>When the launch presentation is complete, upload it to the portal (PDF) and fill in the “Launch Presentation Date”.</li></ol><h4>Engagement updates</h4><p>The POC/Concierge keeps up with engagement status through communication with the researcher, mentor, and student.</p><ol><li>A schedule is established for checking in with the engagement team.</li><li>As milestones are completed, the POC fills in the appropriate fields of the engagement in the portal.</li><li>If a completed milestone is tied to payment, the POC will make sure payment is made.</li></ol><h4>Wrap Presentation</h4><p>After an engagement is complete the student gives a wrap presentation.</p><ol><li>The student uses this <a href=#>template</a> provided as a guide.</li><li>When the wrap presentation is complete, upload it to the portal (PDF) and fill in the “Wrap Presentation Date”.</li><li>Change engagement status to “Finishing Up”.</li></ol>" ][/accordion]
      [accordion summary="Finish an engagement" color="white" text="<div><p>Final Reports, Knowledge Base Contributions, and Exit Interviews.</p><h4>Final Report</h4><p>Final Reports are essential to our NSF reporting.</p><ol><li>We recommend sending questions to the researcher in an email or Google Doc and then entering their responses into the engagement page on the Portal.</li><li>Only relevant questions need to be filled out.</li><li>The report can be augmented with additional insights and knowledge.</li><li>Once these materials are collected and entered into the portal, the status of the engagement is changed to “Complete”.</li></ol><h4>Knowledge Base contributions</h4><p>Student-facilitators should provide helpful engagement materials back to the community to help the next researcher facing similar topics.</p><ol><li>Share “Nuggets of information” on <a href=http://ask.ci/>Ask.CI</a>—post a question you were trying to answer and the answer you found.</li><li>Add links on the <a href=/ci-links>CI Links page</a>  of the Support portal to the material that you found most useful in doing your engagement.</li></ol><h4>Exit interviews</h4>SC member conducts exit interviews in a Zoom conversation with team members. The final payment is tied to the completion of the student exit interview. Example questions: <ol><li>All participants:<br>What went well? Could anything have gone better?</li><li>For student-facilitators:<br>After your experience with this engagement, are you interested in pursuing a career as a Research Computing Facilitator?</li></ol></div>" ][/accordion]
    </section>
    <img class="block w-40 not-prose ms-auto mb-2" src="/themes/contrib/asp-theme/images/logos/match.svg" alt="match team" >
    <section class="bg-light-teal px-5 py-10 mb-5" >
      <h2 class="colored-square colored-square-orange">MATCH Premier Guide</h2>
      <p>
        Researchers are matched with consultants who have the expertise to help with massive allocations or using ACCESS resources in novel ways. MATCH Premier Consultants are selected from the Computational Science and Support Network (CSSN) depending on the researcher's needs - they may be facilitators, research software engineers, or other types of appropriate support personnel.
      </p>
      <p class="text-dark-teal font-extrabold mb-4">
        Researchers work closely with a SC member to bring an engagement through the following steps.
      </p>
      [accordion summary="Request an engagement" color="white" text="<div><p>Researcher submits a project and secures funding.</p><ol><li>Researcher creates a Support Portal account, if they don’t have one.</li><li>Researcher fills a request <a href=#>form</a> with assistance from a SC member.</li><li>SC member reviews submission, and clicks “Accept engagement” if it seems viable.</li><li>Accepted engagements are shared at the next SC meeting.</li></ol><h4>Publishing an engagement</h4><ol><li>When engagements are “Accepted”, additional engagement information fields are revealed.</li><li>SC members work with researcher to identify: <ul><li>Engagement image</li><li>Appropriate tags</li><li>3 or more engagement milestones</li></ul></li><li>Check for completion:<ul><li>Are necessary fields filled in?</li><li>Is the engagement well conceived and described?</li><li>Do the milestones and timeline look reasonable?</li><li>Confirm how the engagement is being funded. <em>Funding for the MATCH Premier consultants are arranged directly between the researcher's institution and the consultant. We anticipate that personnel participating in the MATCH Premier program will be deployed at institutions across the country, and partially funded for other work at their home institutions.</em></li></ul></li><li>After the necessary fields are filled in, the engagement link is sent to the SC for review prior to their next meeting.</li><li>The engagement is reviewed by the SC at their next meeting.</li></ol></div>" ][/accordion]
      [accordion summary="Recruit Team members" color="white"  text="<div><p>SC member matches a consultant to an accepted engagement.</p><h4>Recruiting consultants</h4><p>Consultants are usually identified by SC member associated with engagement but occasionally, all consultants  are notified when engagements are recruiting. In this case, the following steps are followed.</p><ol><li>Consultants express interest by clicking “I’m interested” button. Engagement manager contacts consultants that express interest.</li><li>Potential consultants are interviewed.</li><li>Suitable candidates are connected to researchers for approval.</li></ol></div>"][/accordion]
      [accordion summary="Implement an engagement" color="white" text="<p>Consultant carries out project with PI. Research moves forward.</p><h4>Launch Presentation</h4><p>After the consultant has time to familiarize themself with the Engagement, they present a launch presentation. The first payment is typically tied to this presentation.</p><ol><li>This <a href=#>template</a> is provided as a guide for the launch presentation.</li><li>When the launch presentation is complete, upload it to the portal (PDF) and fill in the “Launch Presentation Date”.</li></ol><h4>Engagement updates</h4><p>The associated SC member keeps up with engagement status through communication with the researcher, mentor, and consultant.<p><ol><li>A schedule is established for checking in with Engagement teams.</li><li>As milestones are completed, the SC member fills in the appropriate fields of the engagement in the portal.</li><li>If a completed milestone is tied to payment, the SC member will make sure payment is made.</li></ol><h4>Wrap Presentation</h4><p>After an Engagement is complete the consultant gives a wrap presentation.</p><ol><li>This <a href=#>template</a> is provided as a guide for wrap presentations.</li><li>When the wrap presentation is complete, upload it to the portal (PDF) and fill in the “Wrap Presentation Date”.</li><li>Change engagement status to “Finishing Up”</li></ol>"][/accordion]
      [accordion summary="Finish an engagement" color="white" text="<div><p>Final reports, Knowledge Base contributions, and exit interviews.</p><h4>Final report</h4><p>Final Reports are essential to our NSF reporting.</p><ol><li>We recommend sending questions to the researcher in an email or Google Doc and then entering their responses into the engagement page on the Portal.<li>Only relevant questions need to be filled out.</li><li>The report can be augmented with additional insights and knowledge.</li><li>Once these materials are collected and entered into the portal, the status of the Engagement is changed to “Complete”.</li></ol><h4>Knowledge Base contributions</h4><p>The team should provide helpful engagement materials back to the community to help the next researcher facing similar topics.</p><ol><li>Share “Nuggets of information” on <a href=http://ask.ci/>Ask.CI</a>—post a question you were trying to answer and the answer you found.</li><li>Add links on the <a href=/ci-links>CI Links page</a> of the Support portal to the material that you found most useful in doing your engagement.</li></ol><h4>Exit Interviews</h4><p>SC member conducts exit interviews in a Zoom conversation with team members. The final payment is tied to the completion of the exit interview.</p><p>Example questions:<ul><li>What went well?</li><li>Could anything have gone better?</li></ul></p></div>"][/accordion]
    </section>
  </div>
</div>
EOT;
  update_node_body($nid, $body, $format);
}

/**
 * Tools page content (if node is 6109)
 */
function access_misc_update_10004(&$sandbox) {
  // Tools page.
  $nid = 6109;
  $format = 'full_no_editor';
  $body = <<<EOT
<p class="prose text-dark-teal text-2xl leading-9 mb-10">
Try these cutting-edge tools designed to streamline your time to science. These tools drastically reduce development time, allowing researchers to swiftly unlock the full potential of HPC systems.
</p>
<div class="grid grid-cols-1 md--grid-cols-3 gap-10 mb-10" >
	<div class="border border-black border-solid md--col-span-3"></div>

	<div class="flex flex-col items-center">
		<img class="w-56 mb-2 mx-auto not-prose" src="/themes/contrib/asp-theme/images/logos/access-ondemand.svg">
		<p class="font-black text-center">Improving the ACCESS experience</p>
	</div>

	<div class="flex flex-col">
		<p>Utilize remote computing resources easily from any device. The simplified interface makes it easy to use  your favorite apps for data visualization, simulations, modeling, and more. 		</p>
       	<div>
			<a  class="btn btn-primary" href="/tools/ondemand">FIND OUT MORE</a>
		</div>
	</div>

	<div>
		<div class="flex mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Remote access web portal</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Zero installation</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Easy to use</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Available on many resources</span>
	    </div>
	</div>

	<div class="border border-black border-solid md--col-span-3"></div>

	<div class="flex flex-col items-center">
		<img class="w-56 mb-2 mx-auto not-prose" src="/themes/contrib/asp-theme/images/logos/pegasus-stacked.svg">
		<p class="font-black text-center">Easy to use hosted workflow system</p>
	</div>

	<div class="flex flex-col ">
		<p>Orchestrate jobs and data movements across ACCESS resource providers. Workflow can be a single task, or contain 1,000s of tasks with interdependencies.</p>
       <div>
			<a  class="btn btn-primary" href="/tools/pegasus">FIND OUT MORE</a>
		</div>
	</div>

	<div>
		<div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Data Management</span>
	    </div>

	    <div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Provenance Tracking</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
          	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Automatic Error Recovery</span>
	    </div>
	    <div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Reproducibility</span>
	    </div>
		<div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Reusability</span>
	    </div>
	</div>

	<div class="border border-black border-solid md--col-span-3"></div>

	<div class="flex flex-col items-center">
		<img class="w-56 mb-2 mx-auto not-prose" src="/themes/contrib/asp-theme/images/logos/science-gateways.svg">
		<p class="font-black text-center">Web platforms for research and education</p>
	</div>

	<div class="flex flex-col">
		<p>Grow and broaden participation for communities of scientists and educators through simple web interfaces connected to software, data, and HPC resources.</p>
       <div>
			<a  class="btn btn-primary" href="/tools/science-gateways">FIND OUT MORE</a>
		</div>
	</div>

	<div>
		<div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">630+ science gateways</span>
	    </div>
	    <div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Education and technical advice</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Project sustainability training</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">User interface design consulting</span>
	    </div>
		<div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Community knowledge sharing</span>
	    </div>
	</div>

	<div class="border border-black border-solid md--col-span-3"></div>

	<div class="flex flex-col items-center">
		<img class="w-56 mb-2 mx-auto not-prose" src="/themes/contrib/asp-theme/images/logos/xdmod-dk.png">
		<p class="font-black text-center">Data to analyze and optimize your work</p>
	</div>

	<div class="flex flex-col">
		<p>XDMoD collects usage data from all ACCESS allocated resources and provides a user interface to display the data.</p>
    	<div>
			<a  class="btn btn-primary" href="/tools/xdmod">FIND OUT MORE</a>
		</div>
	</div>

	<div>
		<div class="flex  mb-3">
        	<div class="not-prose shrink-0 me-3">
            	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          	</div>
          	<span class="font-extrabold">Monitor allocation usage</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">Optimize job efficiency and allocation usage</span>
	    </div>
	    <div class="flex  mb-3">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <span class="font-extrabold">View historical usage</span>
	    </div>
	</div>
</div>
EOT;
  update_node_body($nid, $body, $format);
}

/**
 * Update Pegasus page content and formatting for new theme.
 */
function access_misc_update_10005(&$sandbox) {
  // Pegasus.
  $nid = 268;
  $format = 'full_no_editor';
  $body = <<<EOT
<div class="grid grid-cols-1 md--grid-cols-4 gap-5">
  <div class="col-1 col-span-3 row-span-2">
    <section class="mb-5" id="about">
      <p class="prose text-dark-teal text-2xl leading-9 mb-10">Construct, run, and debug workflows from a Jupyter Notebook. Perform simple interactions on the command line. Work across environments and get started quickly with sample workflows using a Python API.</p>
      <div class="grid grid-cols-1 md--grid-cols-3">
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold mb-1">Data Management</p><p>Data transfer, input selection, and output registration as auxiliary jobs to the workflow.</p>
          </div>
        </div>
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold mb-1">Error Recovery</p>
            <p>Retried tasks, workflow checkpoints, remapping, and alternative data sources for staging.</p>
          </div>
        </div>
        <div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold mb-1">Provenance Tracking</p><p>Trace a workflow and its outputs, including information about data sources and software used.</p>
          </div>
        </div>
      </div>
      <div class="mt-5 mb-0">
        <a class="btn btn-primary mb-5" href="https://access.pegasus.isi.edu">TRY PEGASUS</a>
        <a class="btn btn-md-teal mb-5" href="https://xsedetoaccess.ccs.uky.edu/confluence/redirect/ACCESS+Pegasus.html">SEE DOCUMENTATION</a>
      </div>
    </section>

    <section class="pt-10 mb-10" id="pegasus-workflows">

      <div class="flex items-center">
        <div>
          <h2 class="colored-square colored-square-orange">Workflows</h2>
          <div><p>We have Jupyter based training notebooks available that walk you through creating simple diamond workflow (and more complex ones) using the Pegasus Python API and executing them on ACCESS resources.</p>
        </div>
      </div>
      <div>
        <img class='not-prose' src='/themes/contrib/asp-theme/images/misc/pegasus-workflow.jpg' >
      </div>
    </div>

    [accordion summary="Why use workflows" text="<div><p>Scientific Workflow Management Systems (WMS) such as Pegasus are vital tools for scientists and researchers in a wide range of fields. They provide a structured environment for the design, execution, and monitoring of complex computational tasks, enabling researchers to manage and process large amounts of data efficiently.<br><span class='font-semibold'>Some reasons you should consider using a system like Pegasus WMS:</span></p><div class='grid grid-cols-6 gap-5'><div><img class='my-0' src='/themes/contrib/asp-theme/images/icons/agreement.png'></div><div class='col-span-5'><p class='mb-0 text-dark-teal font-extrabold'>REPRODUCIBILITY</p>Document and reproduce your analyses, ensuring their validity, with scientific workflows.</div><div><img class='my-0' src='/themes/contrib/asp-theme/images/icons/cycle.png'></div><div class='col-span-5'><p class='mb-0 text-dark-teal font-extrabold'>AUTOMATION</p>Automate repetitive and time-consuming tasks and reduce your workload.</div><div><img class='my-0' src='/themes/contrib/asp-theme/images/icons/decision.png'></div><div class='col-span-5'><p class='mb-0 text-dark-teal font-extrabold'>SCALABILITY</p>Handle large data sets and complex analyses and take on bigger research problems.</div><div><img class='my-0' src='/themes/contrib/asp-theme/images/icons/growth.png'></div><div class='col-span-5'><p class='mb-0 text-dark-teal font-extrabold'>REUSABILITY</p>Build libraries of reusable code and tools that can be adapted by other researchers.</div></div></div>"][/accordion]

    [accordion summary="See workflow examples" text="<div class='grid  grid-cols-1 md--grid-cols-10 gap-5 mb-10'><div class='flex flex-col items-center md--col-span-3'><p class='text-center text-dark-teal font-extrabold'>SINGLE JOB</p><img class='h-full  not-prose mb-2' src='/themes/contrib/asp-theme/images/misc/workflow-step1.jpg' alt='workflow step 1'><div class='text center'><a class='btn btn-secondary' href='https://xsedetoaccess.ccs.uky.edu/confluence/redirect/Single-Job.html'>SEE EXAMPLE</a></div></div><div class='flex flex-col items-center md--col-span-3'><p class='text-center text-dark-teal  font-extrabold'>SET OF JOBS</p><img class='h-full  not-prose  mb-2' src='/themes/contrib/asp-theme/images/misc/workflow-step2.jpg' alt='workflow step 2'><div class='text=center'><a class='btn btn-secondary' href='https://xsedetoaccess.ccs.uky.edu/confluence/redirect/Set-of-Independent-Jobs.html'>SEE EXAMPLE</a></div></div><div class='flex flex-col items-center md--col-span-4'><p class='text-center text-dark-teal font-extrabold'>SPLIT/MERGE WORKFLOW</p><img class='h-full  not-prose  mb-2' src='/themes/contrib/asp-theme/images/misc/workflow-step3.jpg' alt='workflow step 3'><div><a class='btn btn-secondary' href='https://xsedetoaccess.ccs.uky.edu/confluence/redirect/Merge-Workflow.html'>SEE EXAMPLE</a></div></div></div>"][/accordion]
  </section>

  <section class="pt-10 mb-10" id="using-pegasus">
    <h2 class="colored-square colored-square-orange">Getting Started with Pegasus</h2>
    <p>To start you need some Python/Jupyter Notebook knowledge, familiarity with a terminal window, and an ACCESS allocation. <a href="https://allocations.access-ci.org/">How to get an ACCESS Allocation</a>.</p>

    [accordion summary="Get setup" text="<p>Logon with your ACCESS ID and use Open OnDemand. You specify which allocations you have the first time you logon.</p><div class='grid grid-cols-2 gap-5'><div><img class='border border-solid border-black not-prose mb-5' src='/themes/contrib/asp-theme/images/misc/ci-logon.jpg' alt='C I logon screen'><p class='text-dark-teal font-extrabold mb-2'>SINGLE SIGN ON WITH YOUR ACCESS ID</p><p>All registered users with an active allocation automatically have an ACCESS Pegasus account.</div><div><img  class='border border-solid border-black not-prose mb-5' src='/themes/contrib/asp-theme/images/misc/sdsc.jpg' alt='sdsc'><p class='text-dark-teal font-extrabold mb-2'>CONFIGURE RESOURCES ONCE</p><p>Use Open OnDemand instance at resource providers to install SSH keys and determine location allocation ID.</p></div></div>"][/accordion]

    [accordion summary="Run workflows on ACCESS" text="<p>To get started you only need some Python/Jupyter Notebook knowledge, some experience using a terminal window, and an ACCESS allocation.</p><div class='grid grid-cols-1 md--grid-cols-2 gap-y-5 gap-x-10'><div><img class='border  border-black border-solid not-prose' src='/themes/contrib/asp-theme/images/misc/create-the-workflow.jpg'></div><div class='flex flex-col justify-center'><p class='mb-0 text-5xl text-orange font-medium'>1</p><div class='mb-0 text-dark-teal font-extrabold'>CREATE THE WORKFLOW</div><ul class='my-0'><li>Use Pegasus API in Jupyter Notebook or use our examples</li><li>Submit your workflow for execution,</li></ul></div><div><img class='border border-solid border-black not-prose' src='/themes/contrib/asp-theme/images/misc/commandline.gif'></div><div class='flex flex-col justify-center'><p class='mb-0 text-5xl text-orange font-medium'>2</p><p class='mb-0 text-dark-teal font-extrabold'>PROVISION COMPUTE RESOURCES</p><ul class='my-0'><li>Use HTCondor Annex tool to provision pilot jobs on your allocated ACCESS resources</li></ul></div><div><img class='border border-solid border-black not-prose' src='/themes/contrib/asp-theme/images/misc/monitor-execution.jpg'></div><div class='flex-col items-center'><p class='mb-0 text-5xl text-orange font-medium'>3</p><p class='mb-0 text-dark-teal font-extrabold'>MONITOR THE EXECUTION</p><ul class='my-0'><li>Follow the workflow execution within the notebook or in the terminal</li><li>You can see what resources you brought in using the terminal</li></ul></div></div>"][/accordion]
  </section>
</div>

<div class="hidden md--block col-2 sticky top-10">
  <nav class="bg-md-teal mb-10 p-5">
    <a class="font-extrabold text-white leading-5 py-2 no-underline hover--underline hover--text-light-teal block" href="#">ACCESS Pegasus</a>
    <a class="font-semibold text-white leading-5 py-2 no-underline hover--underline hover--text-light-teal block ms-4" href="#about">About</a>
    <a class="font-semibold text-white leading-5 py-2 no-underline hover--underline hover--text-light-teal block ms-4" href="#pegasus-workflows">Workflows</a>
    <a class="font-semibold text-white leading-5 py-2 no-underline hover--underline hover--text-light-teal block ms-4" href="#using-pegasus">Getting Started with Pegasus</a>
    <a class="font-semibold text-white leading-5 py-2 no-underline hover--underline hover--text-light-teal block ms-4" href="#pegasus-support">Pegasus Support</a>
  </nav>
</div>
</div>
<section class="bg-light-teal -mx-50% px-50% py-10" id="pegasus-support">
  <div class="container">
    <h2 class="colored-square colored-square-orange">ACCESS Pegasus Support</h2>
    <div class="grid grid-cols-1 sm--grid-cols-2 md--grid-cols-3 gap-5">
      [square icon="/themes/contrib/asp-theme/images/icons/video-orange.svg" color="orange" title="TUTORIAL VIDEO" link="https://www.youtube.com/watch?v=4wiyLFGwJg4" text="A step by step guide  to using ACCESS Pegasus"][/square]
      [square icon="/themes/contrib/asp-theme/images/icons/ico-documentation.svg" title="DOCUMENTATION" link="https://xsedetoaccess.ccs.uky.edu/confluence/redirect/ACCESS+Pegasus.html" text="Detailed information about setup and use"][/square]
      [square icon="/themes/contrib/asp-theme/images/logos/pegasus-b.svg" title="AFFINITY GROUP" link="https://support.access-ci.org/affinity-groups/pegasus" text="Announcements, Slack, email list and Github"][/square]
    </div>
  </div>
</section>
EOT;
  update_node_body($nid, $body, $format);
}

/**
 * Block update for Announcements block.
 */
function access_misc_update_10006(&$sandbox) {
  $bid = 63;
  $format = 'full_html';
  $body = <<<EOT
<div class="card">
    <div class="card-body">
        <h3 class="card-title mt-0">
            Posting Announcements
        </h3>
        <p>
            Do you have an announcement to share with the ACCESS community?
        </p>
        <p>
            <a class="btn btn-outline-secondary bg-white text-sm" href="/news-request">Add Announcement</a>
        </p>
    </div>
</div>
EOT;
  update_block_body($bid, $body, $format);
  node_replace(458, 6110);
}

/**
 * Update ACCESS OnDemand page for new theme.
 */
function access_misc_update_10006(&$sandbox) {
  // ACCESS OnDemand node.
  $nid = 267;
  $format = 'full_no_editor';
  $body = <<<EOT
  	<div class="grid grid-cols-1 md--grid-cols-4 gap-5">
  <div class="col-1 col-span-3 row-span-2">

	<section class="mb-10" id="about">
      	<p class="prose text-dark-teal text-2xl leading-9 mb-10"> Open OnDemand is an easy-to-use web portal that is being deployed on ACCESS resources to allow researchers to compute from anywhere without client software or command-line interface, and significantly speed up the time to science.</p>

	<div class="grid grid-cols-1 md--grid-cols-3">

  	<div class="flex">
    	<div class="not-prose shrink-0 me-3">
      	<img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
     	</div>
      <div>
        <p class="font-extrabold">Zero Installation</p>
        <p>Run entirely in your browser. No software installation required.</p>
      </div>
      </div>

     	<div class="flex">
          <div class="not-prose shrink-0 me-3">
            <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
          </div>
          <div>
            <p class="font-extrabold">Easy to use</p>
            <p>A simple interface so you can start computing immediately.</p>
          </div>
      </div>

      <div class="flex">
        <div class="not-prose shrink-0 me-3">
          <img class="mt-[3px]" src="/themes/contrib/asp-theme/images/icons/check-bullet.png" alt="">
        </div>
        <div>
          <p class="font-extrabold">Compatible with any device</p>
	  <p>Launch on any device with a browser—even a mobile phone or tablet.</p>
        </div>
      </div>

    </div>
  </section>

  <section class="mb-10" id="ondemand-faq">
 	<h2 class="colored-square colored-square-orange">ACCESS OnDemand FAQ</h2>

    	[accordion summary="What is the difference between ACCESS OnDemand and Open OnDemand?" text=" ACCESS OnDemand is a standardized instance of Open OnDemand that is being adopted by ACCESS resource providers. <a href='https://www.youtube.com/watch?v=4-w-4wjlnPk&ab_channel=OH-TECH'>Watch a video about Open OnDemand.</a>"][/accordion]

    	[accordion summary="How can I learn to use ACCESS OnDemand?" text="Follow the links of the participating RPs (listed above) for  instructions on using their ACCESS OnDemand (AOD) service. You need to have an ACCESS allocation at the participating RP to use AOD."][/accordion]

    	[accordion summary="How do I get help using ACCESS OnDemand at a specific Resource Provider?" text="Each RP has support pages associated with their ACCESS OnDemand service. These are linked in the table above. If you don’t find the answer you need on these pages, or at the resource provider’s help desk, you can open a <a href='https://support.access-ci.org/help-ticket'>support help ticket</a>. The Open OnDemand team also offers a variety of ways to get support for platform-related topics. "][/accordion]

    	[accordion summary=" How do I request to have an application installed on a resource I use?" text="Open a <a href='https://support.access-ci.org/help-ticket'>support help ticket</a>."][/accordion]

    	[accordion summary="I’m an ACCESS resource provider and I want to make OnDemand available on my systems. How do I get started?" text="Please follow the steps outlined in the <a href='https://readthedocs.access-ci.org/projects/integration-roadmaps/en/latest/tasks/ACCESS_OnDemand_Portal_Integration_v1.html'>ACCESS OnDemand service integration roadmap</a>."][/accordion]

    	[accordion summary="Open OnDemand has made it really easy for me to use ACCESS resources. Where can I learn more about it or get engaged in the community?" text="<a href='https://openondemand.org/get-involved'>Read this page</a> to learn the many ways to join the Open OnDemand community and get involved. Join our <a href='https://support.access-ci.org/affinity-groups/open-ondemand'>Affinity Group</a> to get up to the minute announcements about our community-organized monthly Tips and Tricks Calls and other events."][/accordion]

  </section>
</div>

<div class="col-2 sticky top-10">
  <nav class="bg-md-teal mb-10 p-5">
    <a class="font-extrabold text-white no-underline hover--underline hover--text-light-teal block" href="#">ACCESS OnDemand</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#about">About</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#ondemand-faq">ACCESS OnDemand FAQ</a>
    <a class="font-semibold text-white no-underline hover--underline hover--text-light-teal block ms-4" href="#ondemand-support">ACCESS OnDemand Support</a>
  </nav>
</div>
</div>

<section class="bg-light-teal -mx-50% px-50% py-10" id="ondemand-support">
  <h2 class="colored-square colored-square-orange">ACCESS OnDemand Support</h2>

  <div class="grid grid-cols-1 sm--grid-cols-2 md--grid-cols-3 gap-5">

  [square icon="/themes/contrib/asp-theme/images/logos/ood.jpg" title="Affinity Group" link="https://support.access-ci.org/affinity-groups/open-ondemand" text="Announcements, links to Slack, Discourse, email and Github."][/square]

	[square icon="/themes/contrib/asp-theme/images/icons/documentation.svg" title="Documentation" link="https://osc.github.io/ood-documentation/latest" text="Search for a specific topic or browse for general info." ][/square]

	[square icon="/themes/contrib/asp-theme/images/icons/discourse.svg" title="Discourse" link="https://discourse.openondemand.org" text="Browse recent questions on the Get Help thread or leave one of your own." ][/square]

	</div>
</section>
EOT;
  update_node_body($nid, $body, $format);
}
