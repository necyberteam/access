<?php

/**
 * @file
 * Post update functions for CSSN.
 */

use Drupal\cssn\Plugin\Util\CssnSubmissionsSort;

/**
 * Add 'ACCESS CSSN' to the region taxonomy.
 */
function cssn_update_9000() {
  $term = \Drupal::entityTypeManager()->getStorage('taxonomy_term')->create([
    'vid' => 'region',
    'name' => 'ACCESS CSSN',
  ]);
  $term->save();
}

/**
 * Sort current CSSN submissions.
 */
function cssn_update_9001() {
  new CssnSubmissionsSort(0, 80);
}

/**
 * Sort current CSSN submissions.
 */
function cssn_update_9002() {
  new CssnSubmissionsSort(80, 160);
}

/**
 * Sort current CSSN submissions.
 */
function cssn_update_9003() {
  new CssnSubmissionsSort(160, 240);
}

/**
 * Rebuild role permissions.
 */
function cssn_update_9004() {
  $nids = [267, 224];
  foreach ($nids as $nid) {
    \Drupal::database()->insert('nodeaccess')
      ->fields([
        'nid' => $nid,
        'gid' => 6,
        'realm' => 'nodeaccess_rid',
        'grant_view' => 1,
        'grant_update' => 0,
        'grant_delete' => 0,
      ])
      ->execute();
  }
  node_access_rebuild();
}
